!function(){"use strict";angular.module("ngSequoia",["angular-lodash","ng-sortable","infinite-scroll","ngAnimate"])}(),function(){"use strict";function e(){return{restrict:"AE",replace:!0,templateUrl:"sequoia-search.html",scope:{tree:"=",isSearching:"=",buttons:"=",isEditing:"="},link:function(e){e.search=function(){e.query.length?(e.isSearching=e.query?!0:!1,e.tree.setNodesInPath(e.tree.nodes),e.tree.setCurrentNodes(e.tree.find(e.tree.template.title,e.query)),e.tree.paginate()):e.clear()},e.clear=function(){e.query="",e.isSearching=!1,e.tree.setCurrentNodes(e.tree.getNodesInPath()),e.tree.paginate()}}}}angular.module("ngSequoia").directive("sequoiaSearch",e)}(),function(){"use strict";var e={root:"Home",edit:"Edit",select:"Select",deselect:"Deselect",goToSubitems:"Go to subitems",addSubitems:"Add subitems",addNode:"Add node",remove:"Delete",done:"Done",search:"&rsaquo;",searchClear:"&times;",showSelected:"Show selected",hideSelected:"Hide selected",deselectAll:"Deselect all",backToList:"Back to list",move:"Move",modalSelect:"Select",up:"Up a level",searchText:"Search for an item by title"},t={id:"_id",nodes:"nodes",title:"title"},n={allowSelect:!0,allowSearch:!0,canEdit:!1,inline:!1,buttons:{},limit:0},a={sort:!0,handle:".sequoia-move-handle",ghostClass:"as-sortable-dragging"};angular.module("ngSequoia").constant("BUTTONS",e).constant("NODE_TEMPLATE",t).constant("DEFAULT_OPTIONS",n).constant("SORTABLE_OPTIONS",a)}(),function(){"use strict";function e(e,t,n,a,i){return{restrict:"AE",replace:!0,templateUrl:"angular-sequoia.html",scope:{treeNodes:"=sequoiaTree",model:"=?ngModel",template:"=?nodeTemplate",options:"=?",path:"=?sequoiaTreePath"},link:function(o){function s(){o.options=_.defaults(o.options||{},a),o.canEdit=o.options.canEdit,o.inline=o.options.inline,o.allowSelect=o.options.allowSelect,o.isMultiSelect=1===o.options.limit?!1:!0,o.breadcrumbs=[],o.buttons=_.defaults(o.options.buttons,n),o.sortableOptions=_.assign({},i,{onSort:l}),o.tree=new e(o.treeNodes,o.template,o.buttons),o.model=t.setModel(o.isMultiSelect,o.model),o.containerStyle=o.inline?{}:{overflow:"scroll","max-height":"400px"}}function l(e){o.treeNodes=e.models}function d(){o.tree.paginate(),o.finished=o.tree.pagination.finished}o.load=function(e){o.onlySelected=!1;var t=e?e:o.path?o.path:null;o.tree.isValidNode(t)?(o.tree.setCurrentNodes(t[o.tree.template.nodes]),o.breadcrumbs=o.tree.breadcrumbs(t[o.tree.template.id]),o.path=t,o.parentNode=o.tree.findParentNode(o.breadcrumbs)):(o.tree.setCurrentNodes(),o.breadcrumbs=[],o.parentNode=null,o.path=null),o.tree.resetPagination(),d(),o.$emit("nodes:updated")},o.loadMore=function(){d()},o.select=function(e){_.isUndefined(o.model)&&(o.model=t.setModel(o.isMultiSelect,o.model)),e[o.tree.template.id]&&(0!==o.options.limit&&o.model.length===o.options.limit?o.notification="You cannot select more than "+o.options.limit+" items!":o.isMultiSelect?o.model.push(e[o.tree.template.id]):o.model=e[o.tree.template.id])},o.deselect=function(e){if(o.isMultiSelect){var t=e[o.tree.template.id]?_.indexOf(o.model,e[o.tree.template.id]):-1;-1!==t&&o.model.splice(t,1)}else o.model=""},o.deselectAll=function(){o.model=o.isMultiSelect?[]:""},o.isSelected=function(e){return o.isMultiSelect?-1!==_.indexOf(o.model,e[o.tree.template.id])?!0:!1:o.model===e[o.tree.template.id]},o.toggleSelected=function(){if(o.onlySelected)o.onlySelected=!1,o.tree.setCurrentNodes(o.tree.getNodesInPath());else{o.onlySelected=!0;var e=o.tree.findSelected(o.model);o.tree.setNodesInPath(o.tree.nodes),o.tree.setCurrentNodes(e)}d()},s(),o.$watchCollection("treeNodes",function(t){t&&(o.tree=new e(o.treeNodes,o.template,o.buttons),o.load())}),o.$watchCollection("path",function(e){e&&o.load()}),o.load(),o.showModal=function(){o.load(),o.modalShown=!0},o.closeModal=function(){o.modalShown=!1},o.toggleEditing=function(e){o.isEditing&&(e.isSubmitted=!0),(!e||e.$valid)&&(o.treeNodes=o.tree.tree,o.isEditing=!o.isEditing)},o.addNode=function(e){o.tree.isValidNode(e)&&o.load(e),o.tree.addNode(),d(),o.isEditing=!0},o.remove=function(e){o.tree.removeNode(e),d()},o.closeNotification=function(){o.notification=""}}}}e.$inject=["SequoiaTree","SequoiaTreeUtils","BUTTONS","DEFAULT_OPTIONS","SORTABLE_OPTIONS"],angular.module("ngSequoia").directive("sequoiaTree",e)}(),function(){"use strict";function e(e,t,n,a){var i=function(e,i,o){this.template=i||n,this.tree=t.checkNodeStructure(_.isArray(e)?e[0]:{},this.template)?e:[],this.pagination={},this.buttons=o||a,this.resetPagination()};return i.prototype.findParentNode=function(e){return _.last(_.dropRight(e))},i.prototype.buildPathToNode=function(e){return t.buildPath(e,this.tree,"",this.template,this.buttons.root)},i.prototype.paginate=function(){var e=function(e,t,n){return e.length>t?e.slice(n,n+t):e},t=e(this.currentNodes,this.pagination.limit,this.pagination.startkey);this.pagination.startkey=_.indexOf(this.currentNodes,_.last(t)),this.nodes=_.union(this.nodes,t),this.nodes.length===this.currentNodes.length&&(this.pagination.finished=!0)},i.prototype.resetPagination=function(){this.pagination={startkey:0,limit:20,finished:!1}},i.prototype.setCurrentNodes=function(e){this.nodes=[],this.pagination.startkey=0,this.currentNodes=_.isArray(e)?e:this.tree},i.prototype.setNodesInPath=function(e){this.nodesInPath=_.isArray(e)?e:this.tree},i.prototype.getNodesInPath=function(){return _.isArray(this.nodesInPath)?this.nodesInPath:this.tree},i.prototype.isValidNode=function(e){return _.isObject(e)&&e[this.template.nodes]},i.prototype.breadcrumbs=function(e){return t.buildBreadCrumbs(e,this.tree,[],this.template,this.buttons.root)},i.prototype.find=function(e,n){for(var a=[],i=t.contains(this.tree,e,n,[],this.template),o=0;o<i.length;o++)a.push(t.createNodeWithFullPathAsTitle(i[o],this.tree,this.template,this.buttons.root));return a},i.prototype.findSelected=function(n){var a=[],i=[];if(_.isArray(n)){for(var o=0;o<n.length;o++)a=_.union(a,t.selected(n[o],this.tree,[],this.template));for(var s=0;s<a.length;s++)i.push(t.createNodeWithFullPathAsTitle(a[s],this.tree,this.template,this.buttons.root))}else _.isString(n)?(a=t.selected(n,this.tree,[],this.template),i.push(t.createNodeWithFullPathAsTitle(a[0],this.tree,this.template,this.buttons.root))):e.warn("You must pass an array of IDs or a single ID in order to find the selected nodes!");return i},i.prototype.addNode=function(){var e={};e[this.template.id]=t.guid(),e[this.template.title]="",e[this.template.nodes]=[],this.currentNodes.push(e)},i.prototype.removeNode=function(e){this.currentNodes=_.without(this.currentNodes,e),this.nodes=_.without(this.nodes,e),this.tree=t.pruneTree(this.tree,e[this.template.id],this.template)},i}e.$inject=["$log","SequoiaTreeUtils","NODE_TEMPLATE","BUTTONS"],angular.module("ngSequoia").factory("SequoiaTree",e)}(),function(){"use strict";function e(e){var t={};return t.guid=function(){var e=function(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)};return e()},t.checkNodeStructure=function(t,n){if(!t)return!1;for(var a=_.values(n),i=0;i<a.length;i++)if(!_.has(t,a[i]))return e.warn("The node structure is not valid!"),!1;return!0},t.exists=function(e,n,a,i){return _.isArray(e)?_.some(e,function(e){return e[n]===a?!0:t.exists(e[i.nodes],n,a,i)}):!1},t.contains=function(e,n,a,i,o){if(_.isArray(e))for(var s=0;s<e.length;s++)e[s][n].toLowerCase().indexOf(a.toLowerCase())>-1&&i.push(e[s]),t.contains(e[s][o.nodes],n,a,i,o);return i},t.buildBreadCrumbs=function(e,n,a,i,o){n=n||[];var s={};s[i.title]=o,a=a.length?a:[s];for(var l=0;l<n.length;l++)(n[l][i.id]===e||t.exists(n[l][i.nodes],i.id,e,i))&&a.push(n[l]),t.buildBreadCrumbs(e,n[l][i.nodes],a,i,o);return a},t.buildPath=function(e,n,a,i,o){n=n||[];for(var s=0;s<n.length;s++)(n[s][i.id]===e[i.id]||t.exists(n[s][i.nodes],i.id,e[i.id],i))&&(a+=a.length?" » ":"Full path: "+o+" » ",a+=n[s][i.title]),a=t.buildPath(e,n[s][i.nodes],a,i,o);return a},t.selected=function(e,n,a,i){if(_.isArray(n))for(var o=0;o<n.length;o++)n[o]._id===e&&a.push(n[o]),t.selected(e,n[o][i.nodes],a,i);return a},t.getParentNode=function(e,n,a,i){n=n||[],i=i||[];for(var o=0;o<n.length;o++)(n[o][a.id]===e||t.exists(n[o][a.nodes],a.id,e,a))&&i.push(n[o]),t.getParentNode(e,n[o][a.nodes],a,i);return i},t.createNodeWithFullPathAsTitle=function(e,n,a,i){var o={};return o[a.id]=e[a.id],o[a.title]=e[a.title],o.fullpath='<span class="help-text mute">'+t.buildPath(e,n,"",a,i)+"</span>",_.isArray(e[a.nodes])&&e[a.nodes].length>0&&(o[a.nodes]=e[a.nodes]),o},t.pruneTree=function(e,n,a){for(var i=0;i<e.length;i++){var o=e[i];if(o[a.id]===n)return e.splice(i,1),e;if(o[a.nodes]&&t.pruneTree(o[a.nodes],n,a))return 0===o[a.nodes].length&&delete o[a.nodes],e}},t.setModel=function(t,n){return t?_.isArray(n)?n:_.isString(n)?(e.warn("You passed a string to a multi-select model, but the model is expected to be an array!"),[n]):(e.warn("The model is expected to be an array for a multi-select tree!"),[]):_.isString(n)?n:_.isArray(n)?(e.warn("You passed an array to a single-select model, but the model is expected to be a string!"),n[0]):(e.warn("The model is expected to be a string for a single-select tree!"),"")},t}e.$inject=["$log"],angular.module("ngSequoia").service("SequoiaTreeUtils",e)}(),angular.module("ngSequoia").run(["$templateCache",function(e){e.put("angular-sequoia.html",'<div class="sequoia">\n  <div class="sequoia-modal-container" data-ng-if="!inline">\n    <a href="" class="sequoia-button sequoia-button-info" data-ng-click="showModal()" data-ng-bind="model.length ? isMultiSelect ? buttons.modalSelect + \' (\' + model.length + \')\' : buttons.modalSelect + \' (1)\' : buttons.modalSelect"></a>\n    <div data-ng-if="modalShown">\n      <div class="sequoia-overlay"></div>\n      <div class="sequoia-modal">\n        <div class="sequoia-modal-title">\n          <h4 class="pull-left" data-ng-bind-html="buttons.modalSelect"></h4>\n          <a href="" class="sequoia-modal-close pull-right" data-ng-click="closeModal()">&times;</a>\n        </div>\n        <div data-ng-include="\'sequoia-tree.html\'"></div>\n      </div>\n    </div>\n  </div>\n\n  <div data-ng-if="inline" data-ng-include="\'sequoia-tree.html\'"></div>\n\n</div>\n'),e.put("sequoia-breadcrumbs.html",'<li data-ng-if="breadcrumbs.length" data-ng-repeat="link in breadcrumbs" data-ng-class="$last ? \'last\' : \'\'">\n  <a data-ng-if="!$last" href="" data-ng-click="load(link)" data-ng-bind="link[tree.template.title]"></a>\n  <span data-ng-if="$last" data-ng-bind="link[tree.template.title]"></span>\n</li>\n'),e.put("sequoia-item-actions.html",'<span data-ng-if="allowSelect && isSelected(node)">\n  <a class="sequoia-button sequoia-button-danger" href="" title="Deselect" data-ng-click="deselect(node)" data-ng-bind-html="buttons.deselect"></a>\n</span>\n\n<span data-ng-if="allowSelect && !isSelected(node)">\n  <a class="sequoia-button sequoia-button-primary" href="" title="Select" data-ng-click="select(node)" data-ng-bind-html="buttons.select"></a>\n</span>\n\n<span data-ng-if="node[tree.template.nodes] && node[tree.template.nodes].length">\n  <a class="sequoia-button sequoia-button-info" href="" title="Go to subitems" data-ng-click="load(node)" data-ng-bind-html="buttons.goToSubitems"></a>\n</span>\n'),e.put("sequoia-item-edit-actions.html",'<span>\n  <a class="sequoia-button sequoia-button-danger" href="" title="Remove" data-ng-click="remove(node)" data-ng-bind-html="buttons.remove"></a>\n</span>\n\n<span data-ng-if="node[tree.template.nodes] && node[tree.template.nodes].length">\n  <a class="sequoia-button sequoia-button-info" href="" title="Go to subitems" data-ng-click="load(node)" data-ng-bind-html="buttons.goToSubitems"></a>\n</span>\n\n<span data-ng-if="!node[tree.template.nodes] || !node[tree.template.nodes].length">\n  <a class="sequoia-button sequoia-button-info" href="" title="Add subitems" data-ng-click="addNode(node)" data-ng-bind-html="buttons.addSubitems"></a>\n</span>\n\n<span>\n  <a class="sequoia-button sequoia-button-default sequoia-move-handle" href="" data-ng-bind-html="buttons.move"></a>\n</span>'),e.put("sequoia-item.html",'<span class="sequoia-item-title">\n  <span data-ng-if="!isEditing" data-ng-bind-html="node[tree.template.title] + \'<br/>\' + node.fullpath"></span>\n  <span data-ng-if="isEditing">\n    <input required name="itemTitle_{{::node[tree.template.id]}}" type="text" data-ng-model="node[tree.template.title]" placeholder="Enter a {{::tree.template.title}}">\n    <p class="help-text has-error" data-ng-show="form.isSubmitted && form[\'itemTitle_\' + node[tree.template.id]].$error.required">The item {{::tree.template.title}} is required!</p>\n  </span>\n</span>\n\n<span class="sequoia-item-actions" data-ng-include="\'sequoia-item-actions.html\'" data-ng-if="!isEditing"></span>\n<span class="sequoia-item-actions" data-ng-include="\'sequoia-item-edit-actions.html\'" data-ng-if="isEditing"></span>\n'),e.put("sequoia-search.html",'<ng-form name="sequoiaSearchForm" data-ng-submit="search()" novalidate>\n  <input type="text" placeholder="{{::buttons.searchText}}" data-ng-model="query" name="search" data-ng-disabled="isEditing" />\n  <a class="sequoia-button sequoia-button-success" href="" data-ng-if="query.length" data-ng-click="search()" data-ng-bind-html="buttons.search"></a>\n  <a class="sequoia-button sequoia-button-default" href="" data-ng-if="isSearching" data-ng-click="clear()" data-ng-bind-html="buttons.searchClear"></a>\n</ng-form>\n'),e.put("sequoia-tree-actions.html",'<ul>\n  <li data-ng-if="(model.length || onlySelected) && !isEditing">\n    <a class="sequoia-button sequoia-button-info" href="" data-ng-click="toggleSelected()" data-ng-bind-html="model.length && !onlySelected ? buttons.showSelected : !model.length && onlySelected ? buttons.backToList : buttons.hideSelected"></a>\n  </li>\n\n  <li data-ng-if="model.length && onlySelected && !isEditing">\n    <a class="sequoia-button sequoia-button-info" href="" data-ng-click="deselectAll()" data-ng-bind-html="buttons.deselectAll"></a>\n  </li>\n\n  <li data-ng-if="isEditing && !onlySelected">\n    <a class="sequoia-button sequoia-button-success" href="" data-ng-click="addNode()" data-ng-bind-html="buttons.addNode"></a>\n  </li>\n\n  <li data-ng-if="canEdit && !onlySelected">\n    <a class="sequoia-button sequoia-button-info" href="" data-ng-click="toggleEditing(sequoiaEditForm)" data-ng-bind-html="isEditing ? buttons.done : buttons.edit"></a>\n  </li>\n\n</ul>\n'),e.put("sequoia-tree.html",'<ng-form name="sequoiaEditForm" novalidate>\n\n  <div class="sequoia-search">\n    <div data-ng-if="::options.allowSearch" class="sequoia-search-form" data-sequoia-search data-is-searching="searchEnabled" data-is-editing="isEditing" data-tree="tree" data-buttons="buttons"></div>\n\n    <div class="sequoia-actions" data-ng-include="\'sequoia-tree-actions.html\'"></div>\n  </div>\n\n  <ul data-ng-if="!searchEnabled && !onlySelected" class="sequoia-breadcrumbs" data-ng-include="\'sequoia-breadcrumbs.html\'"></ul>\n\n  <p class="sequoia-up-one-level" data-ng-if="parentNode && !searchEnabled">\n    <a href="" class="sequoia-button sequoia-button-info" data-ng-click="load(parentNode)" data-ng-bind-html="buttons.up"></a>\n  </p>\n\n  <div class="sequoia-notification" data-ng-show="notification">\n    <p>\n      <span class="pull-left" data-ng-bind="notification"></span>\n      <a class="pull-right sequoia-button" href="" data-ng-click="closeNotification()" data-ng-bind-html="buttons.searchClear"></a>\n    </p>\n  </div>\n\n  <div data-ng-style="containerStyle">\n    <div data-infinite-scroll="loadMore()" data-infinite-scroll-disabled="finished" data-infinite-scroll-listen-for-event="nodes:updated" data-infinite-scroll-reset="true" data-ng-attr-data-infinite-scroll-parent="{{!inline || undefined}}">\n      <ul id="sequoia-tree" class="sequoia-tree" data-ng-sortable="sortableOptions" data-ng-model="tree.nodes">\n        <li class="sequoia-animate-repeat" data-ng-repeat="node in tree.nodes track by node[tree.template.id]" data-ng-include="\'sequoia-item.html\'"></li>\n      </ul>\n    </div>\n  </div>\n\n</ng-form>\n')}]);